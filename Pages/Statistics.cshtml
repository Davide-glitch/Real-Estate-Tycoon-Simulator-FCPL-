@page "/Statistics"
@model DavidEstateArchitect.Pages.StatisticsModel
@{
    ViewData["Title"] = "Player Statistics";
}
<!-- Hero Section: consistent with Home page -->
<div class="hero-section text-white text-center py-4 mb-4"
    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; position: relative; overflow: hidden;">
    <div class="container py-4 position-relative">
        <h1 class="display-5 fw-bold mb-2"><i class="bi bi-graph-up-arrow"></i> Player Statistics</h1>
        <p class="lead mb-3 text-white-75">Track your empire's progress: net worth, rentals, and transactions.</p>
        <div class="d-flex gap-3 justify-content-center flex-wrap">
            <a class="btn btn-light btn-lg px-4 fw-bold" asp-page="/Game" style="border-radius: 12px;">
                <i class="bi bi-joystick"></i> Back to Game
            </a>
            <a class="btn btn-outline-light btn-lg px-4 fw-bold" asp-page="/Index" style="border-radius: 12px; border-width: 2px;">
                <i class="bi bi-list-ul"></i> Browse Properties
            </a>
        </div>
    </div>
</div>

<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col">
            <h1 class="display-4 mb-0">
                <i class="bi bi-graph-up-arrow"></i> Player Statistics
            </h1>
            <p class="text-muted">Round @(Model.State?.CurrentRound ?? 0) | Track your tycoon empire progress</p>
        </div>
        <div class="col-auto">
            <a asp-page="/Game" class="btn btn-primary">
                <i class="bi bi-arrow-left"></i> Back to Game
            </a>
        </div>
    </div>

    @if (Model.Stats != null && Model.State != null)
    {
        <!-- Key Performance Indicators -->
        <div class="row g-3 mb-4">
            <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <div class="card-body text-white">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="text-white-50 small">Net Worth</div>
                                <h3 class="mb-0">@Model.State.TotalNetWorth.ToString("C0")</h3>
                                <small class="text-white-75">Balance + Properties - Debt</small>
                            </div>
                            <div class="rounded-circle bg-white bg-opacity-25 p-3">
                                <i class="bi bi-bank2 fs-3"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <div class="card-body text-white">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="text-white-50 small">Total Profit</div>
                                <h3 class="mb-0">@((Model.Stats.TotalMoneyEarned - Model.Stats.TotalMoneySpent).ToString("C0"))</h3>
                                <small class="text-white-75">Earned: @Model.Stats.TotalMoneyEarned.ToString("C0")</small>
                            </div>
                            <div class="rounded-circle bg-white bg-opacity-25 p-3">
                                <i class="bi bi-cash-coin fs-3"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <div class="card-body text-white">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="text-white-50 small">Property Value</div>
                                <h3 class="mb-0">@Model.TotalPropertyValue.ToString("C0")</h3>
                                <small class="text-white-75">@Model.TopProperties.Count properties owned</small>
                            </div>
                            <div class="rounded-circle bg-white bg-opacity-25 p-3">
                                <i class="bi bi-buildings fs-3"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    <div class="card-body text-white">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="text-white-50 small">Rental Income</div>
                                <h3 class="mb-0">@Model.Stats.TotalRentalIncome.ToString("C0")</h3>
                                <small class="text-white-75">@Model.ActiveRentals active contracts</small>
                            </div>
                            <div class="rounded-circle bg-white bg-opacity-25 p-3">
                                <i class="bi bi-key-fill fs-3"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Statistics -->
        <div class="row g-4">
            <!-- Transaction Summary -->
            <div class="col-lg-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-primary text-white py-3">
                        <h5 class="mb-0"><i class="bi bi-bar-chart-line"></i> Transaction Summary</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-6">
                                <div class="p-3 bg-light rounded">
                                    <div class="text-muted small">Properties Bought</div>
                                    <div class="h4 mb-0 text-success">@Model.Stats.TotalPropertiesBought</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="p-3 bg-light rounded">
                                    <div class="text-muted small">Properties Sold</div>
                                    <div class="h4 mb-0 text-danger">@Model.Stats.TotalPropertiesSold</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="p-3 bg-light rounded">
                                    <div class="text-muted small">Total Spent</div>
                                    <div class="h4 mb-0 text-warning">@Model.Stats.TotalMoneySpent.ToString("C0")</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="p-3 bg-light rounded">
                                    <div class="text-muted small">Total Earned</div>
                                    <div class="h4 mb-0 text-info">@Model.Stats.TotalMoneyEarned.ToString("C0")</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="p-3 bg-light rounded">
                                    <div class="text-muted small">Taxes Paid</div>
                                    <div class="h5 mb-0 text-secondary">@Model.Stats.TotalTaxesPaid.ToString("C0")</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="p-3 bg-light rounded">
                                    <div class="text-muted small">Maintenance</div>
                                    <div class="h5 mb-0 text-secondary">@Model.Stats.TotalMaintenancePaid.ToString("C0")</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-3 p-3 bg-success bg-opacity-10 rounded">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <strong class="text-success">Highest Net Worth Achieved</strong>
                                </div>
                                <div class="h4 mb-0 text-success">@Model.Stats.HighestBalance.ToString("C0")</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Market Events -->
            <div class="col-lg-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-warning text-dark py-3">
                        <h5 class="mb-0"><i class="bi bi-newspaper"></i> Active Market Events</h5>
                    </div>
                    <div class="card-body">
                        @if (Model.ActiveEvents.Any())
                        {
                            <div class="list-group list-group-flush">
                                @foreach (var evt in Model.ActiveEvents.Take(5))
                                {
                                    <div class="list-group-item border-0 px-0">
                                        <div class="d-flex align-items-start">
                                            <div class="flex-shrink-0 me-3">
                                                @if (evt.Type == EventType.EconomicBoom || evt.Type == EventType.PriceIncrease || evt.Type == EventType.SafetyImprovement)
                                                {
                                                    <span class="badge bg-success rounded-circle p-2">
                                                        <i class="bi bi-arrow-up"></i>
                                                    </span>
                                                }
                                                else if (evt.Type == EventType.Recession || evt.Type == EventType.PriceDecrease || evt.Type == EventType.NaturalDisaster)
                                                {
                                                    <span class="badge bg-danger rounded-circle p-2">
                                                        <i class="bi bi-arrow-down"></i>
                                                    </span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-info rounded-circle p-2">
                                                        <i class="bi bi-info"></i>
                                                    </span>
                                                }
                                            </div>
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1">@evt.Title</h6>
                                                <p class="mb-1 small text-muted">@evt.Description</p>
                                                <div class="d-flex gap-2">
                                                    @if (evt.AffectedCounty != null)
                                                    {
                                                        <span class="badge bg-secondary">@evt.AffectedCounty</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="badge bg-primary">All Counties</span>
                                                    }
                                                    <span class="badge bg-light text-dark">
                                                        @evt.RoundsRemaining rounds left
                                                    </span>
                                                    <span class="badge" style="background-color: @(evt.ImpactMultiplier > 1 ? "#28a745" : evt.ImpactMultiplier < 1 ? "#dc3545" : "#6c757d")">
                                                        @{
                                                            var impactPercent = (evt.ImpactMultiplier - 1) * 100;
                                                            var sign = impactPercent > 0 ? "+" : "";
                                                        }
                                                        @sign@(impactPercent.ToString("F1"))% impact
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <div class="text-center py-4 text-muted">
                                <i class="bi bi-info-circle fs-1"></i>
                                <p class="mt-2">No active market events</p>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Top Properties -->
            <div class="col-lg-6">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-info text-white py-3">
                        <h5 class="mb-0"><i class="bi bi-trophy"></i> Top 5 Most Valuable Properties</h5>
                    </div>
                    <div class="card-body">
                        @if (Model.TopProperties.Any())
                        {
                            <div class="list-group list-group-flush">
                                @foreach (var (prop, index) in Model.TopProperties.Select((p, i) => (p, i)))
                                {
                                    var value = prop.MarketValue > 0 ? prop.MarketValue : prop.Price;
                                    <div class="list-group-item border-0 px-0">
                                        <div class="d-flex align-items-center">
                                            <div class="flex-shrink-0 me-3">
                                                <span class="badge bg-primary rounded-circle" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">
                                                    @(index + 1)
                                                </span>
                                            </div>
                                            <div class="flex-grow-1">
                                                <div class="d-flex justify-content-between align-items-start">
                                                    <div>
                                                        <h6 class="mb-1">@prop.Address, @prop.City</h6>
                                                        <div class="d-flex gap-2 flex-wrap">
                                                            <span class="badge bg-secondary">@prop.Type</span>
                                                            <span class="badge bg-primary">@prop.County</span>
                                                            <span class="badge" style="background-color: @(prop.Safety == SafetyLevel.Safe ? "#28a745" : prop.Safety == SafetyLevel.Moderate ? "#ffc107" : "#dc3545")">
                                                                @prop.Safety
                                                            </span>
                                                            @if (prop.RenovationLevel > 0)
                                                            {
                                                                <span class="badge bg-warning text-dark">
                                                                    <i class="bi bi-hammer"></i> L@prop.RenovationLevel
                                                                </span>
                                                            }
                                                        </div>
                                                        @if (prop.TotalAppreciation > 0)
                                                        {
                                                            <small class="text-success">
                                                                <i class="bi bi-graph-up"></i> +@prop.TotalAppreciation.ToString("C0") appreciation
                                                            </small>
                                                        }
                                                    </div>
                                                    <div class="text-end">
                                                        <h5 class="mb-0 text-success">@value.ToString("C0")</h5>
                                                        @if (prop.Status == EstateStatus.Rented)
                                                        {
                                                            <small class="text-muted">
                                                                <i class="bi bi-key"></i> Rented
                                                            </small>
                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <div class="text-center py-4 text-muted">
                                <i class="bi bi-house fs-1"></i>
                                <p class="mt-2">No properties owned yet</p>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="col-lg-6">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-success text-white py-3">
                        <h5 class="mb-0"><i class="bi bi-clock-history"></i> Recent Transactions</h5>
                    </div>
                    <div class="card-body" style="max-height: 500px; overflow-y: auto;">
                        @if (Model.RecentTransactions.Any())
                        {
                            <div class="list-group list-group-flush">
                                @foreach (var tx in Model.RecentTransactions)
                                {
                                    <div class="list-group-item border-0 px-0 py-2">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div class="d-flex align-items-center gap-2">
                                                @if (tx.Type == TransactionType.Purchase || tx.Type == TransactionType.Renovation || tx.Type == TransactionType.Tax || tx.Type == TransactionType.Maintenance)
                                                {
                                                    <i class="bi bi-arrow-down-circle text-danger"></i>
                                                }
                                                else
                                                {
                                                    <i class="bi bi-arrow-up-circle text-success"></i>
                                                }
                                                <div>
                                                    <div class="small">
                                                        <span class="badge bg-secondary">@tx.Type</span>
                                                        @tx.Details
                                                    </div>
                                                    <small class="text-muted">Round @tx.RoundNumber</small>
                                                </div>
                                            </div>
                                            <strong class="@(tx.Amount >= 0 ? "text-success" : "text-danger")">
                                                @{
                                                    var absAmount = Math.Abs(tx.Amount);
                                                    var displayAmount = tx.Amount >= 0
                                                        ? $"+{absAmount.ToString("C0")}"
                                                        : $"-{absAmount.ToString("C0")}";
                                                }
                                                @displayAmount
                                            </strong>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <div class="text-center py-4 text-muted">
                                <i class="bi bi-inbox fs-1"></i>
                                <p class="mt-2">No transactions yet</p>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Active Loans -->
            @if (Model.ActiveLoans.Any())
            {
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-danger text-white py-3">
                            <h5 class="mb-0"><i class="bi bi-credit-card"></i> Active Loans</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Purpose</th>
                                            <th class="text-end">Principal</th>
                                            <th class="text-end">Interest Rate</th>
                                            <th class="text-end">Monthly Payment</th>
                                            <th class="text-end">Months Left</th>
                                            <th class="text-end">Total Paid</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var loan in Model.ActiveLoans)
                                        {
                                            <tr>
                                                <td>@loan.Purpose</td>
                                                <td class="text-end">@loan.Principal.ToString("C0")</td>
                                                <td class="text-end">@(loan.InterestRate * 100)%</td>
                                                <td class="text-end">@loan.MonthlyPayment.ToString("C0")</td>
                                                <td class="text-end">@loan.MonthsRemaining</td>
                                                <td class="text-end text-danger">@loan.TotalPaid.ToString("C0")</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                            <div class="alert alert-warning mb-0">
                                <strong>Total Debt:</strong> @Model.TotalDebt.ToString("C0")
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> No statistics available yet. Start playing to see your progress!
        </div>
    }
</div>

@section Scripts {
<script>
    // Add smooth scroll behavior for transaction list
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Statistics page loaded successfully');
    });
</script>
}
